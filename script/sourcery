#!/bin/bash

set -e

bin/sourcery/bin/sourcery --config .sourcery.botenginekit.yml
bin/sourcery/bin/sourcery --config .sourcery.woloxkit.yml
bin/sourcery/bin/sourcery --config .sourcery.googleapi.yml
# For some reason, probably a sourcery bug, we need to
# run it twice to properly generate the source code.
# otherwise coding key enum are not properly generated
# for enums that conform to AutoCodable
bin/sourcery/bin/sourcery --config .sourcery.botenginekit.yml
bin/sourcery/bin/sourcery --config .sourcery.woloxkit.yml
bin/sourcery/bin/sourcery --config .sourcery.googleapi.yml

# This import the necessary modules in order for the
# autogenerated code to compile
bot_engine_kit_path="./Sources/BotEngineKit/Autogenerated.swift"
wolox_kit_path="./Sources/WoloxKit/Autogenerated.swift"
googleapi_path="./Sources/GoogleAPI/Autogenerated.swift"
echo -e "import Foundation\n$(cat $bot_engine_kit_path)" > $bot_engine_kit_path
echo -e "import Foundation\nimport GoogleAPI\n$(cat $wolox_kit_path)" > $wolox_kit_path
echo -e "import Foundation\n$(cat $googleapi_path)" > $googleapi_path
